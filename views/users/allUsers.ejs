<% layout("/layouts/boilerplate") %>


<% usersWithPosts.forEach(item => { %>
  <div class="card mb-3 shadow-sm rounded-4">
    <div class="card-body d-flex align-items-center">
      
      <!-- Profile Icon -->
      <div class="me-3">
        <% if (item.user.profileImage) { %>
          <img src="<%= item.user.profileImage %>" 
               class="rounded-circle" style="width:50px; height:50px;">
        <% } else { %>
          <!-- Default profile icon -->
          <i class="bi bi-person-circle" style="font-size:2rem; color:#e83e8c;"></i>
        <% } %>
      </div>

      <!-- User info -->
      <div>
        <h5 class="mb-1">@<%= item.user.username %></h5>
        <p class="mb-1 text-muted">Posts: <%= item.postCount %></p>
        <% if (item.latestPost) { %>
          <img src="<%= item.latestPost.image %>" 
               class="img-fluid rounded mb-2" style="max-height:100px;">
          <p class="mb-0"><%= item.latestPost.caption %></p>
        <% } %>
      </div>

      <!-- Follow/Unfollow Button -->
      <div class="ms-auto">
        <% if (!currentUser.following.includes(item.user._id)) { %>
          <form action="/users/<%= item.user._id %>/follow" method="POST">
            <button class="btn btn-pink rounded-pill">Follow</button>
          </form>
        <% } else { %>
          <form action="/users/<%= item.user._id %>/unfollow" method="POST">
            <button class="btn btn-secondary rounded-pill">Unfollow</button>
          </form>
        <% } %>
      </div>

    </div>
  </div>
<% }) %>
